const imageGen=(image,maskImage)=>{const canvas=document.createElement("canvas");canvas.width=image.width,canvas.height=image.height;const context=canvas.getContext("2d");context.drawImage(image,0,0),null!=maskImage&&context.drawImage(maskImage,0,0,maskImage.width,maskImage.height,0,0,canvas.width,canvas.height),document.getElementById("preview").src=canvas.toDataURL("image/png");let imageData=context.getImageData(0,0,canvas.width,canvas.height),data=imageData.data;for(let i=0;i<data.length;i+=4){const color=data[i];data[i]=data[i+1]=data[i+2]=data[i+3]=color}context.putImageData(imageData,0,0),document.getElementById("redImg").src=canvas.toDataURL("image/png"),context.clearRect(0,0,canvas.width,canvas.height),context.drawImage(image,0,0),null!=maskImage&&context.drawImage(maskImage,0,0,maskImage.width,maskImage.height,0,0,canvas.width,canvas.height),imageData=context.getImageData(0,0,canvas.width,canvas.height),data=imageData.data;for(let i=0;i<data.length;i+=4){const color=data[i+1];data[i]=data[i+1]=data[i+2]=data[i+3]=color}context.putImageData(imageData,0,0),document.getElementById("greenImg").src=canvas.toDataURL("image/png"),context.clearRect(0,0,canvas.width,canvas.height),context.drawImage(image,0,0),null!=maskImage&&context.drawImage(maskImage,0,0,maskImage.width,maskImage.height,0,0,canvas.width,canvas.height),imageData=context.getImageData(0,0,canvas.width,canvas.height),data=imageData.data;for(let i=0;i<data.length;i+=4){const color=data[i+2];data[i]=data[i+1]=data[i+2]=data[i+3]=color}context.putImageData(imageData,0,0),document.getElementById("blueImg").src=canvas.toDataURL("image/png")},gen=()=>{const file=document.getElementById("inputFile").files[0];if(null==file||-1===file.type.indexOf("image/"))return;const url=URL.createObjectURL(file),maskFile=document.getElementById("inputMaskFile").files[0];let maskImage=null,maskImageEnable=!1,standby=!1,maskStandby=!1;if(null!=maskFile){if(-1==maskFile.type.indexOf("image/"))return void console.log("nope");{maskImageEnable=!0;const maskUrl=URL.createObjectURL(maskFile);maskImage=new Image,maskImage.onload=()=>{maskStandby=!0},maskImage.src=maskUrl,console.log("mask enable")}}const image=new Image;image.onload=()=>{standby=!0},image.src=url;let id=setInterval(()=>{standby&&(!maskImageEnable||maskImageEnable&&maskStandby)&&(console.log("go"),imageGen(image,maskImage),clearInterval(id))},0)},dl=num=>{switch(num){case 0:downloadImage(document.getElementById("redImg").src,"_red");break;case 1:downloadImage(document.getElementById("greenImg").src,"_green");break;case 2:downloadImage(document.getElementById("blueImg").src,"_blue")}},downloadImage=(imageUrl,n)=>{let name=document.querySelector("#name").value.replace(/\.png/g,""),link=document.createElement("a");link.href=imageUrl,link.download=name+n+".png",link.click()};document.getElementById("inputFile").addEventListener("input",e=>{gen()});